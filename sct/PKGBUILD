pkgname=sct
pkgver=0.5
pkgrel=1
pkgdesc="Set color temperature of the screen"
arch=('x86_64')
url="https://umaxx.net"
license=('public-domain')
depends=('libx11' 'libxrandr')
source=("https://umaxx.net/dl/$pkgname-$pkgver.tar.gz")
sha256sums=('15380c3775e38e0a46a57343c29cacff06dde2f340c2cc09e08bb118cee93053')

prepare() {
    cd "$srcdir/$pkgname-$pkgver"
    rm Makefile
    # Create the Makefile dynamically using a here-document
    cat > Makefile << 'EOF'
CC=gcc
CFLAGS=-O3
PREFIX=/usr/local/
MANPREFIX=\$(PREFIX)/share/man

all: sct

sct: sct.o
	\$(CC) \$(CFLAGS) -o sct sct.o

sct.o: sct.c
	\$(CC) \$(CFLAGS) -c sct.c

install: sct
    mkdir -p \$(DESTDIR)\$(PREFIX)/bin
    cp -f stc \$(DESTDIR)\$(PREFIX)/bin
    chmod 755 \$(DESTDIR)\$(PREFIX)/bin/sct

clean:
	rm -f sct.o sct
EOF
}

build() {
    cd "$srcdir/$pkgname-$pkgver"
    make
}

package() {
    cd "$srcdir/$pkgname-$pkgver"
    # Pass PREFIX during installation
    make DESTDIR="$pkgdir" PREFIX=/usr install
}
